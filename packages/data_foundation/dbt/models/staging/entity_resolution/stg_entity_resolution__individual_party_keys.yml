# Documentation for the identity stitching staging model.
models:
  - name: stg_entity_resolution__individual_party_keys
    columns:
      - name: individual_party_key
        data_type: varchar
        description: |-
          Represents an individual as understood by the system of record as of the
          time the interaction with the individual took place.  This is used in conjunction
          with an individual_id to connect across multiple systems to understand
          a single entity.

          Records from separate systems should use the non-unique party key to join to the
          individual entity table, and then be aggregated to on the entity id to understand
          interactions of the same customer.

          *Example*:
          ``` sql
          select
              e.individual_id,
              sum(t.revenue) revenue,
              count(distinct visit_id) visits 

          from transactions t
          left join individual_entity e
              on t.individual_party_key = e.individual_party_key
          left join site_visits v
              on v.individual_party_key = e.individual_party_key
          group by e.individual_entity_id
          ```
      - name: individual_id
        data_type: varchar
        description: |-
          Represents an individual as understood by the entity resolution system.
          A single individual will have multiple party keys, however they will all resolve to the
          same entity id.

          *Example*:
          ``` sql
          select
              e.individual_id,
              sum(t.revenue) revenue,
              count(distinct visit_id) visits 

          from transactions t
          left join individual_entity e
              on t.individual_party_key = e.individual_party_key
          left join site_visits v
              on v.individual_party_key = e.individual_party_key
          group by e.individual_entity_id
          ```
      - name: updated_at
        data_type: timestamp_ntz
        description: When the relationship changed
      - name: _loaded_at
        data_type: timestamp_tz
        description: When the record was ingested
    description: >-
      Mappings of individual party keys to individual entities.  This is used to identify unique users
      across multiple platforms
